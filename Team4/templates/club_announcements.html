{% extends "base.html" %}

{% block title %}{{ club.name }} - Announcements{% endblock %}

{% block content %}
<div class="row">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2>
          <i class="bi bi-megaphone text-primary"></i>
          {{ club.name }} Announcements
        </h2>
        <p class="text-muted mb-0">View and manage club announcements</p>
      </div>
      {% if current_role == 'Officer' %}
      <div>
        <a href="{{ url_for('create_announcement', club_id=club.id) }}" class="btn btn-primary">
          <i class="bi bi-plus-circle"></i> New Announcement
        </a>
      </div>
      {% endif %}
    </div>

    {% if announcements %}
      <div class="row">
        {% for announcement in announcements %}
        <div class="col-12 mb-3">
          <div class="card {% if announcement.priority == 'high' %}border-danger{% elif announcement.priority == 'medium' %}border-warning{% endif %}">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <div class="flex-grow-1">
                  <h5 class="card-title mb-2">
                    {% if announcement.priority == 'high' %}
                      <i class="bi bi-exclamation-triangle-fill text-danger me-2"></i>
                    {% elif announcement.priority == 'medium' %}
                      <i class="bi bi-exclamation-circle-fill text-warning me-2"></i>
                    {% else %}
                      <i class="bi bi-info-circle-fill text-info me-2"></i>
                    {% endif %}
                    {{ announcement.title }}
                    {% if announcement.priority == 'high' %}
                      <span class="badge bg-danger ms-2">High Priority</span>
                    {% elif announcement.priority == 'medium' %}
                      <span class="badge bg-warning ms-2">Medium Priority</span>
                    {% endif %}
                  </h5>
                  <p class="card-text">{{ announcement.content }}</p>
                  <small class="text-muted">
                    <i class="bi bi-calendar"></i> 
                    {% if announcement.created_at %}
                      {{ announcement.created_at.strftime('%B %d, %Y at %I:%M %p') if announcement.created_at.strftime else announcement.created_at_formatted }}
                    {% else %}
                      Recently
                    {% endif %}
                    • By {{ announcement.created_by }}
                    {% if announcement.read_by %}
                      • {{ announcement.read_by|length }} read
                    {% endif %}
                  </small>
                </div>
                {% if current_role == 'Officer' %}
                <div class="ms-3">
                  <button class="btn btn-outline-danger btn-sm" 
                          onclick="deleteAnnouncement('{{ announcement.id }}', '{{ announcement.title }}')"
                          title="Delete announcement">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-center py-5">
        <i class="bi bi-megaphone text-muted" style="font-size: 4rem;"></i>
        <h4 class="mt-3 text-muted">No Announcements Yet</h4>
        <p class="text-muted">This club hasn't posted any announcements.</p>
        {% if current_role == 'Officer' %}
        <a href="{{ url_for('create_announcement', club_id=club.id) }}" class="btn btn-primary mt-2">
          <i class="bi bi-plus-circle"></i> Create First Announcement
        </a>
        {% endif %}
      </div>
    {% endif %}

    <div class="mt-4">
      <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Back to Clubs
      </a>
    </div>
  </div>
</div>

<!-- Floating Action Button for Officers -->
{% if current_role == 'Officer' %}
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1000;">
  <a href="{{ url_for('create_announcement', club_id=club.id) }}" 
     class="btn btn-primary btn-lg rounded-circle shadow" 
     title="Create New Announcement">
    <i class="bi bi-plus-lg"></i>
  </a>
</div>
{% endif %}
{% endblock %}

{% block extra_scripts %}
{% if current_role == 'Officer' %}
<script>
function deleteAnnouncement(announcementId, title) {
  if (confirm(`Are you sure you want to delete the announcement "${title}"?`)) {
    fetch(`/api/announcements/${announcementId}/delete`, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        location.reload();
      } else {
        alert('Error deleting announcement: ' + (data.error || 'Unknown error'));
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Error deleting announcement');
    });
  }
}
</script>
{% endif %}
{% endblock %}